<div class="activity-viewer-container">
  <mat-card class="date-picker-card">
    <mat-card-content>
      <mat-form-field appearance="fill">
        <mat-label>Select Date</mat-label>
        <input matInput [matDatepicker]="picker" [formControl]="date" (dateChange)="onDateChange($event)">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="errorStatus" class="error-container">
    <mat-card class="error-card">
      <mat-card-title>{{ errorStatus }}</mat-card-title>
      <mat-card-subtitle>{{ errorMessage }}</mat-card-subtitle>
    </mat-card>
  </div>

  <div *ngIf="!loading && !errorStatus" class="activities-container">
    <!-- Group activities by type -->
    <ng-container *ngFor="let activityType of getActivityTypes()">
      <mat-card class="activity-type-card">
        <mat-card-header>
          <mat-card-title>{{ activityType }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-list">
            <mat-card *ngFor="let activity of getActivitiesByType(activityType)" class="activity-card">
              <mat-card-header>
                <mat-card-title>{{ activity.activityDetails.referenceId | manifest: 'activityName' | async }}</mat-card-title>
                <mat-card-subtitle>
                  {{ activity.startDate | date:'shortTime' }} - {{ activity.endDate | date:'shortTime' }}
                  ({{ getActivityDuration(activity) }})
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="activity-stats">
                  <div class="stat-row">
                    <span class="stat-label">Kills:</span>
                    <span class="stat-value">{{ activity.values.kills?.basic?.value || 0 }}</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Deaths:</span>
                    <span class="stat-value">{{ activity.values.deaths?.basic?.value || 0 }}</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Assists:</span>
                    <span class="stat-value">{{ activity.values.assists?.basic?.value || 0 }}</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Efficiency:</span>
                    <span class="stat-value">{{ activity.values.efficiency?.basic?.value || 0 }}</span>
                  </div>
                </div>
                <div class="activity-players">
                  <a mat-button 
                     [href]="'https://www.bungie.net/en/PGCR/' + activity.activityDetails.instanceId + '?character=' + activity.characterId"
                     target="_blank">
                    View PGCR
                  </a>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-card-content>
      </mat-card>
    </ng-container>
  </div>
</div> 